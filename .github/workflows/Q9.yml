name: Automatiser le rollback en cas d'échec du déploiement

on:
  deployment_status:
    types: [failure]

jobs:
  rollback:
    runs-on: ubuntu-latest
    
    steps:
    - name: Log in to Docker Hub
      uses: docker/login-action@v1
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    - name: Redéployer la version précédente
      run: |
        docker pull my-docker-image:${{ env.PREVIOUS_VERSION }}
        docker tag my-docker-image:${{ env.PREVIOUS_VERSION }} ${{ secrets.DOCKER_USERNAME }}/my-docker-image:latest
        docker push ${{ secrets.DOCKER_USERNAME }}/my-docker-image:latest
